<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> StayEase | {% block title %}{% endblock %}</title>

   <!-- Bootstrap Icons CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">


    <style>

    .save-property-btn.active {
    background-color: #ffc107;
    color: #212529;
    border-color: #ffc107;
    }

    .save-property-btn.active .fa-bookmark {
    font-weight: 900; /* Solid icon when saved */
    }
    
    

     .form-label {
        font-size: 0.9rem;
        margin-bottom: 0.3rem;
    }
    .form-select {
        border-radius: 8px;
        border: 1px solid #dee2e6;
        padding: 0.5rem 1rem;
        transition: all 0.3s ease;
    }
    .form-select:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
    }
    .btn-primary {
        padding: 0.5rem;
        border-radius: 8px;
    }
    .btn-outline-secondary {
        border-radius: 8px;
        padding: 0.5rem 1.5rem;
    }

    .rating-input {
        display: flex;
        flex-direction: row-reverse;
        justify-content: flex-end;
    }
    .rating-input input {
        display: none;
    }
    .rating-input label {
        font-size: 2rem;
        color: #ddd;
        cursor: pointer;
        transition: color 0.2s;
    }
    .rating-input input:checked ~ label,
    .rating-input label:hover,
    .rating-input label:hover ~ label {
        color: #ffc107;
    }
    .rating-input input:checked + label {
        color: #ffc107;
    }
    .sticky-top {
        position: -webkit-sticky;
        position: sticky;
        z-index: 1020;
    }
    .card {
        border-radius: 12px;
        overflow: hidden;
        transition: transform 0.2s;
    }
    .card:hover {
        transform: translateY(-5px);
    }
</style>

</head>
<body>

    



<!-- Toast-Message -->
<div aria-live="polite" aria-atomic="true" class="position-relative">
  <div class="toast-container top-0 end-0 p-3">
    {% if messages %}
      {% for message in messages %}
        <div class="toast align-items-center text-bg-{{ message.tags }} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="4000">
          <div class="d-flex">
            <div class="toast-body">
              {{ message }}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>
</div>

<script>
 
</script>


     

<!-- Page Content -->
    
<div >
    {% block content %}{% endblock %}
</div>
    


   
   

    
    

    <!-- Bootstrap JS Bundle (includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
 

<script>
 document.addEventListener('DOMContentLoaded', function () {
    var toastElList = [].slice.call(document.querySelectorAll('.toast'));
    toastElList.forEach(function (toastEl) {
      var toast = new bootstrap.Toast(toastEl);
      toast.show();
    });
  });

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

function saveProperty(event, propertyId, userId) {
    event.preventDefault();

    console.log(propertyId,userId)


    const url = `/api/saved-properties/`;  // Adjust to your API logic
    const method = 'POST';

    fetch(url, {
        method: method,
        headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            user: userId,
            property: propertyId
        })
    })
    .then(response => {
        if (response.ok) {
            alert("Successful Save")
            location.reload();

        } else {
            alert('Something went wrong. Try again.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error occurred. Please try again.');
    });
}



function unSaveProperty(event,savedId) {
  event.preventDefault(); // prevent page reload

  console.log(savedId)

  fetch(`/api/saved-properties/${savedId}/`, {
    method: 'DELETE',
    headers: {
      'X-CSRFToken': csrftoken
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error("Failed to unsave property.");
    }
    alert(`Property  unsaved successfully.`);
    // Optionally: remove the property card from DOM or refresh
    location.reload();
  })
  .catch(error => {
    console.error("Error unsaving property:", error);
    alert("Something went wrong.");
  });
}

function propertyCheckOut(event,inquiryId){
  event.preventDefault();
  console.log("Checkout Button Clicked" + inquiryId)
  const inquiry_url = `/api/inquiries/${inquiryId}/`;

  fetch (inquiry_url,{
    method : 'DELETE',
    headers : {
      'Content-Type' :'application/json',
      'X-CSRFToken' : csrftoken
    }
  })
  .then(response => {
    if(response.ok){
      console.log("Successfully Check Out" + inquiryId)
      alert("Successfully Check Out" + inquiryId)
      location.reload()
    }
    else{
      console.log("Error Occur When Check Out" + inquiryId)
      alert("Error Occur When Check Out" + inquiryId)
      location.reload()
    }
  })
  .catch(error => {
    console.log("Error",error)
  })

  

}

</script>

</body>
</html>
